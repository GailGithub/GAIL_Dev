%Example of variance reductionclear all, close allf=inline('pi*x.*sin(pi.*x.*x)','x');intf=1;xplot=[0:0.01:1]';fplot=f(xplot);h=plot(xplot,fplot,'b-'); set(h,'linewidth',2);n=1e5;%Simple MCx=rand(n,1);fx=f(x);disp('                        Estimate         Error     Estimated Error')simpleMC=mean(fx);errMC=intf-simpleMC;esterrMC=1.96*std(fx)/sqrt(n);fprintf(1,'Simple MC            %12.8f     %8.4e     %8.4e \n',simpleMC,errMC,esterrMC)%Control variatescvf=inline('[x-1/2 x.*x-1/3 x.*x.*x-1/4]','x');cvf=inline('[x-1/2 x.*x-1/3]','x');cvf=inline('[x-1/2]','x');cvx=cvf(x);meancv=mean(cvx);b=[cvx - ones(n,1)*meancv]\[fx - simpleMC];cvMC=simpleMC-meancv*b;yestplot=simpleMC+cvf(xplot)*b;errcvMC=intf-cvMC;esterrcv=1.96*std(fplot-yestplot)/sqrt(n);fprintf(1,'Control variates     %12.8f     %8.4e     %8.4e \n',cvMC,errcvMC,esterrcv) figure; h=plot(xplot,fplot,'b-',xplot,yestplot,'k--',xplot,fplot-yestplot,'g-.'); set(h,'linewidth',2);%Antithetic variatesnov2=n/2;fx1=fx(1:nov2);fx2=f(1-x(1:nov2));fxanti=[fx1; fx2];antiMC=mean(fxanti);errantiMC=intf-antiMC;cov12=cov(fx1,fx2); cov12=cov12(1,2);esterranti=1.96*sqrt((var(fx1)+var(fx2)+2*cov12)/(2*n));fprintf(1,'Antithetic variates  %12.8f     %8.4e     %8.4e \n',antiMC,errantiMC,esterranti)figure; h=plot(xplot,fplot,'b-',xplot,(fplot+fplot(end:-1:1))/2,'k--'); set(h,'linewidth',2);%Importance samplingb=200;ximp=(-1+sqrt(1+2*b*x+(b*b)*x))/b;fimp=(1+b/2)*f(ximp)./(1+b*ximp);impMC=mean(fimp);errimpMC=intf-impMC;esterrimp=1.96*std(fimp)/sqrt(n);fprintf(1,'Importance sampling  %12.8f     %8.4e     %8.4e \n',impMC,errimpMC,esterrimp)figure; h=plot(xplot,fplot,'b-',xplot,(1+b/2)*fplot./(1+b*xplot),'k--'); set(h,'linewidth',2);%Stratified samplingm=50; %number of replicationsk=n/m; %number of strataxstrat=reshape(x,k,m);xstrat=repmat([0:k-1]'/k,1,m)+xstrat/k;fstrat=f(xstrat);stratMC=mean(fstrat,1);erreststrat=1.96*std(stratMC)/sqrt(m);stratMC=mean(stratMC);errstratMC=intf-stratMC;fprintf(1,'Stratified sampling  %12.8f     %8.4e     %8.4e \n',stratMC,errstratMC,erreststrat)